# (SSRF) Server-side Request Forgery

### Explanation
 It's a type of web vulnerability where an attacker can manipulate the server into making unauthorized requests on its behalf. This can lead to various security risks, such as accessing internal systems, bypassing firewalls, or even attacking other servers from within the compromised network.

### Basic SSRF against the local server
#### Context
We have a website that serves a basic ecommerce shop. It has a detail page of every product listed on the shop. Every detail page has a button that sends a request to the api to add the current product to the cart.  

#### Website ennumeration & source code analysis
Once we know the context we want to acces the admin panel **http://localhost/admin**. If we dig deep on the website source code we can see that the requests to add products to the cart are made using this url: **http://stock.ecommerce.net:8080/product/check?productId=1&storeId=1**.  

An important thing we can see with this url is that the request is made to itself using port 8080. We can abuse this by changing the url to the admin panel one **http://localhost/admin**.  

To achieve this we will use Burp Suite.

#### Using Burp Suite to intercept the request
First, we need to open Burp Suite. Then we need to open a chromium using it interface, and visit the target url. Then wee need to locate the button that sends the request. Once we located it we go to Burp Suite and we toggle the intercept button. Then we click the button.

#### Intercepting the request and modifying it
##### Burp Suite Intercept Output Example
```
POST /product/stock HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: [length]
...

stockApi=http%3A%2F%2Fstock.ecommerce.net%28080%2F/product/check%3CproductId=1%1AstoreId=1
```
If we take a closer look to the stockApi body it seems to be encoded. To decode it we select all the string line and use: CTRL + SHIFT + U.

Result: 
```http://stock.ecommerce.net:8080/product/check?productId=1&storeId=1```

Once we have it like this we use CTRL + R to send this request to the repeater & we untoggle the intercept is on button.  

#### Sending the modified request
Now that we have the request body we need to change the stockApi to:  
```http://localhost/admin```

If we made all of the steps we will se the administrator panel on the chromium browser.

> [!NOTE]
> This is a basic example on how to do a SSRF. Usually it will be more complex and will have some request validation. Make sure to allways check to send the urls encoded. Also sometimes you can try bypassing some low profile anti SSRF systems by overencoding url fragments.